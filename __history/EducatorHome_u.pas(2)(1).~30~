unit EducatorHome_u;

interface

uses
  Winapi.Windows, Winapi.Messages, System.SysUtils, System.Variants, System.Classes, Vcl.Graphics,
  Vcl.Controls, Vcl.Forms, Vcl.Dialogs, Data.DB, Vcl.Grids, Vcl.DBGrids,
  Vcl.ComCtrls, dm_u, Vcl.ExtCtrls, Vcl.DBCtrls;

type
  TfrmEducatorHome = class(TForm)
    PageControl1: TPageControl;
    TabSheet1: TTabSheet;
    TabSheet2: TTabSheet;
    dbgEnrolledStudents: TDBGrid;
    DBGrid1: TDBGrid;
    dbnEnrolledStudents: TDBNavigator;
    procedure FormCreate(Sender: TObject);
  private
    { Private declarations }
  public
    { Public declarations }
  end;

var
  frmEducatorHome: TfrmEducatorHome;

implementation
uses Main_u;
{$R *.dfm}

procedure TfrmEducatorHome.FormCreate(Sender: TObject);
begin
dbgEnrolledStudents.DataSource:= dscQuery;
dbnEnrolledStudents.DataSource:= dscQuery;
//SQL Part is nested, the nested select get the attempts table but with educator shown as well
//then by selecting only courses by specific educator and grouping by user
//but instead of the user number I got the name instead by grabbing stuName from the student table
Query.Close;
Query.SQL.Clear;
Query.SQL.Add('SELECT stuName, Round(AVG(aScore),2) as AverageScore FROM ');
Query.SQL.Add(   '(SELECT qEducator, aQuiz, aUser, aScore ');
Query.SQL.Add(   'FROM tblQuizzes, tblAttempts WHERE qQuizID = aQuiz), tblStudents ');
Query.SQL.Add('WHERE (qEducator= 1) AND (stuID=aUser)' {+ IntToStr(iEducatorID)});
Query.SQL.Add('GROUP BY stuName;');
Query.Open;
end;

end.
